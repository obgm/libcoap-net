<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libcoap: coap_split_uri(3)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libcoap<span id="projectnumber">&#160;4.3.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('man_coap_split_uri.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">coap_split_uri(3) </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>coap_uri</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /></head><body><div xml:lang="en" class="refentry" lang="en"><a id="idm1"></a><div class="titlepage"></div><div class="refnamediv"><h2>NAME</h2><p><a href="man_coap_uri.html#coap_uri" target="_self">coap_uri</a>, <a href="man_coap_split_uri.html#coap_split_uri" target="_self"><span class="man-highlight">coap_split_uri</span></a>, <a href="man_coap_split_proxy_uri.html#coap_split_proxy_uri" target="_self">coap_split_proxy_uri</a>, <a href="man_coap_new_uri.html#coap_new_uri" target="_self">coap_new_uri</a>, <a href="man_coap_clone_uri.html#coap_clone_uri" target="_self">coap_clone_uri</a>, <a href="man_coap_delete_uri.html#coap_delete_uri" target="_self">coap_delete_uri</a>, <a href="man_coap_uri_into_options.html#coap_uri_into_options" target="_self">coap_uri_into_options</a> - Work with CoAP URIs </p></div><div class="refsynopsisdiv"><a id="_synopsis"></a><h2>SYNOPSIS</h2><p><span class="strong"><strong>#include &lt;coap3/coap.h&gt;</strong></span></p><p><span class="strong"><strong>int <a class="st-synopsis" href="man_coap_split_uri.html#coap_split_uri" target="_self"><span class="man-highlight">coap_split_uri</span></a>(const uint8_t *<span class="emphasis"><em>uri_def</em></span>, size_t <span class="emphasis"><em>length</em></span>,
coap_uri_t *<span class="emphasis"><em>uri</em></span>);</strong></span></p><p><span class="strong"><strong>int <a class="st-synopsis" href="man_coap_split_proxy_uri.html#coap_split_proxy_uri" target="_self">coap_split_proxy_uri</a>(const uint8_t *<span class="emphasis"><em>uri_def</em></span>, size_t <span class="emphasis"><em>length</em></span>,
coap_uri_t *<span class="emphasis"><em>uri</em></span>);</strong></span></p><p><span class="strong"><strong>coap_uri_t *<a class="st-synopsis" href="man_coap_new_uri.html#coap_new_uri" target="_self">coap_new_uri</a>(const uint8_t *<span class="emphasis"><em>uri_def</em></span>, unsigned int <span class="emphasis"><em>length</em></span>);</strong></span></p><p><span class="strong"><strong>coap_uri_t *<a class="st-synopsis" href="man_coap_clone_uri.html#coap_clone_uri" target="_self">coap_clone_uri</a>(const coap_uri_t *<span class="emphasis"><em>uri</em></span>);</strong></span></p><p><span class="strong"><strong>void <a class="st-synopsis" href="man_coap_delete_uri.html#coap_delete_uri" target="_self">coap_delete_uri</a>(coap_uri_t *<span class="emphasis"><em>uri</em></span>);</strong></span></p><p><span class="strong"><strong>int <a class="st-synopsis" href="man_coap_uri_into_options.html#coap_uri_into_options" target="_self">coap_uri_into_options</a>(const coap_uri_t *<span class="emphasis"><em>uri</em></span>,
const coap_address_t *<span class="emphasis"><em>dst</em></span>, coap_optlist_t **<span class="emphasis"><em>optlist_chain</em></span>,
int <span class="emphasis"><em>create_port_host_opt</em></span>, uint8_t *<span class="emphasis"><em>buf</em></span>, size_t <span class="emphasis"><em>buflen</em></span>);</strong></span></p><p>For specific (D)TLS library support, link with
<span class="strong"><strong>-lcoap-3-notls</strong></span>, <span class="strong"><strong>-lcoap-3-gnutls</strong></span>,
<span class="strong"><strong>-lcoap-3-openssl</strong></span>, <span class="strong"><strong>-lcoap-3-mbedtls</strong></span>
or <span class="strong"><strong>-lcoap-3-tinydtls</strong></span>.   Otherwise, link with
<span class="strong"><strong>-lcoap-3</strong></span> to get the default (D)TLS library support.</p></div><div class="refsect1"><a id="_description"></a><h2>DESCRIPTION</h2><p>This man page describes the functionality available to work with CoAP URIs and
break them down into the component parts.</p><p>A CoAP URI is of the form</p><p>&lt;scheme&gt;&lt;host&gt;&lt;(optional):port&gt;&lt;(optional)path&gt;&lt;(optional)?query&gt;</p><p>where <span class="emphasis"><em>scheme</em></span> can be one of coap://, coaps://, coap+tcp:// and coaps+tcp://.</p><p><span class="emphasis"><em>host</em></span> can be an IPv4 or IPv6 (enclosed in []) address, a DNS resolvable name or
a Unix domain socket name which is encoded as a unix file name with %2F
replacing each / of the file name so that the start of the <span class="emphasis"><em>path</em></span> can easily be
determined.</p><p><span class="emphasis"><em>(optional):port</em></span> is ignored for Unix domain socketâ€™s <span class="emphasis"><em>host</em></span> definitions.</p><p>The parsed uri structure is of the form</p><pre class="programlisting">typedef struct {
  coap_str_const_t host;  /* The host part of the URI */
  uint16_t port;          /* The port in host byte order */
  coap_str_const_t path;  /* The complete path if present or {0, NULL}.
                             Needs to be split using <a href="man_coap_split_path.html#coap_split_path" target="_self">coap_split_path</a>()
                             or <a href="man_coap_uri_into_options.html#coap_uri_into_options" target="_self">coap_uri_into_options</a>(). */
  coap_str_const_t query; /* The complete query if present or {0, NULL}.
                             Needs to be split using <a href="man_coap_split_query.html#coap_split_query" target="_self">coap_split_query</a>()
                             or <a href="man_coap_uri_into_options.html#coap_uri_into_options" target="_self">coap_uri_into_options</a>(). */
  enum coap_uri_scheme_t scheme; /* The parsed scheme specifier. */
} coap_uri_t;</pre></div><div class="refsect1"><a id="_functions"></a><h2>FUNCTIONS</h2><p><span class="strong"><strong><a class="anchor" id="coap_split_uri"></a>Function: <a href="man_coap_split_uri.html#coap_split_uri" target="_self"><span class="man-highlight">coap_split_uri</span></a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_split_uri.html#coap_split_uri" target="_self"><span class="man-highlight">coap_split_uri</span></a></strong></span>() function is used to parse the provided <span class="emphasis"><em>uri_def</em></span> of
length <span class="emphasis"><em>length</em></span> into the component parts held in the <span class="emphasis"><em>uri</em></span> structure.  These
component parts are the host, port, path, query and the CoAP URI scheme.</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_split_proxy_uri.html#coap_split_proxy_uri" target="_self">coap_split_proxy_uri</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_split_proxy_uri.html#coap_split_proxy_uri" target="_self">coap_split_proxy_uri</a></strong></span>() function is used to parse the provided <span class="emphasis"><em>uri_def</em></span> of
length <span class="emphasis"><em>length</em></span> into the component parts held in the <span class="emphasis"><em>uri</em></span> structure.  These
component parts are the host, port, path, query and the URI scheme.  The
schemes also includes support for http:// and https:// as the proxy may need to
be a coap-to-http proxy.</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_new_uri.html#coap_new_uri" target="_self">coap_new_uri</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_new_uri.html#coap_new_uri" target="_self">coap_new_uri</a></strong></span>() function creates a new coap_uri_t structure and populates
it using <span class="strong"><strong><a class="st-desc" href="man_coap_split_uri.html#coap_split_uri" target="_self"><span class="man-highlight">coap_split_uri</span></a></strong></span>() with <span class="emphasis"><em>uri_def</em></span> and <span class="emphasis"><em>length</em></span> as input. The returned
coap_uri_t structure needs to be freed off using <span class="strong"><strong><a class="st-desc" href="man_coap_delete_uri.html#coap_delete_uri" target="_self">coap_delete_uri</a></strong></span>().</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_clone_uri.html#coap_clone_uri" target="_self">coap_clone_uri</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_clone_uri.html#coap_clone_uri" target="_self">coap_clone_uri</a></strong></span>() function duplicates a <span class="emphasis"><em>uri</em></span> coap_uri_t structure.
The returned coap_uri_t structure needs to be freed off using
<span class="strong"><strong><a class="st-desc" href="man_coap_delete_uri.html#coap_delete_uri" target="_self">coap_delete_uri</a></strong></span>().</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_delete_uri.html#coap_delete_uri" target="_self">coap_delete_uri</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_delete_uri.html#coap_delete_uri" target="_self">coap_delete_uri</a></strong></span>() function frees off a previously created <span class="emphasis"><em>uri</em></span>
coap_uri_t structure.</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_uri_into_options.html#coap_uri_into_options" target="_self">coap_uri_into_options</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_uri_into_options.html#coap_uri_into_options" target="_self">coap_uri_into_options</a></strong></span>() function takes the <span class="emphasis"><em>uri</em></span> structure and then takes
CoAP options derived from this information and adds them to <span class="emphasis"><em>optlist_chain</em></span>.
The initial <span class="emphasis"><em>optlist_chain</em></span> entry should be set to NULL before
this function is called (unless <span class="strong"><strong><a class="st-desc" href="man_coap_insert_optlist.html#coap_insert_optlist" target="_self">coap_insert_optlist</a></strong></span>(3) has been previously
used).</p><p>If <span class="emphasis"><em>dst</em></span> is not NULL and <span class="emphasis"><em>create_port_host_opt</em></span> is not 0, then the Uri-Host
option is added in if the <span class="emphasis"><em>uri</em></span> host definition is not an exact match with the
ascii readable version of _dst.</p><p>If the port is not the default port and <span class="emphasis"><em>create_port_host_opt</em></span> is not 0, then
the Port option is added to <span class="emphasis"><em>optlist_chain</em></span>.</p><p>If there is a path, then this is broken down into individual Path options for
each segment which are then added to <span class="emphasis"><em>optlist_chain</em></span>.</p><p>Likewise, if
there is a query, individual Query options for each segment are then added to
<span class="emphasis"><em>optlist_chain</em></span>.</p><p><span class="emphasis"><em>buf</em></span> provides a scratch buffer to use, of size <span class="emphasis"><em>buflen</em></span> bytes.  <span class="emphasis"><em>buf</em></span> needs
to be as big as the path or query lengths.</p><p><span class="strong"><strong>NOTE:</strong></span> It is the responsibility of the application to free off the entries
added to <span class="emphasis"><em>optlist_chain</em></span> using <span class="strong"><strong><a class="st-desc" href="man_coap_delete_optlist.html#coap_delete_optlist" target="_self">coap_delete_optlist</a></strong></span>(3).</p></div><div class="refsect1"><a id="_return_values"></a><h2>RETURN VALUES</h2><p><span class="strong"><strong><a class="st-desc" href="man_coap_split_uri.html#coap_split_uri" target="_self"><span class="man-highlight">coap_split_uri</span></a></strong></span>(), <span class="strong"><strong><a class="st-desc" href="man_coap_split_proxy_uri.html#coap_split_proxy_uri" target="_self">coap_split_proxy_uri</a></strong></span>(), and
<span class="strong"><strong><a class="st-desc" href="man_coap_uri_into_options.html#coap_uri_into_options" target="_self">coap_uri_into_options</a></strong></span>() return 0 on success, else &lt; 0 on failure.</p><p><span class="strong"><strong><a class="st-desc" href="man_coap_new_uri.html#coap_new_uri" target="_self">coap_new_uri</a></strong></span>() and <span class="strong"><strong><a class="st-desc" href="man_coap_clone_uri.html#coap_clone_uri" target="_self">coap_clone_uri</a></strong></span>() return a newly allocated coap_uri_t
structure or NULL on failure.</p></div><div class="refsect1"><a id="_examples"></a><h2>EXAMPLES</h2><p><span class="strong"><strong>Setup PDU and Transmit</strong></span></p><pre class="programlisting">#include &lt;coap3/coap.h&gt;

/*
 * Returns 0 failure, 1 success
 */
static int
parse_and_send_uri(coap_session_t *session, const char *do_uri) {
  coap_uri_t uri;
  coap_optlist_t *optlist = NULL;
  coap_pdu_t *pdu;
  coap_proto_t proto = <a href="man_coap_session_get_proto.html#coap_session_get_proto" target="_self">coap_session_get_proto</a>(session);
  const coap_address_t *dst = <a href="man_coap_session_get_addr_remote.html#coap_session_get_addr_remote" target="_self">coap_session_get_addr_remote</a>(session);
  int res;
  coap_mid_t mid;
#define BUFSIZE 100
  unsigned char buf[BUFSIZE];

  /* Parse the URI */
  res = <a href="man_coap_split_uri.html#coap_split_uri" target="_self"><span class="man-highlight">coap_split_uri</span></a>((const uint8_t*)do_uri, strlen(do_uri), &amp;uri);
  if (res != 0)
    return 0;

  /* Check the scheme matches the session type */
  switch (uri.scheme) {
  case COAP_URI_SCHEME_COAP:
    if (proto != COAP_PROTO_UDP)
      return 0;
    break;
  case COAP_URI_SCHEME_COAPS:
    if (proto != COAP_PROTO_DTLS)
      return 0;
    break;
  case COAP_URI_SCHEME_COAP_TCP:
    if (proto != COAP_PROTO_TCP)
      return 0;
    break;
  case COAP_URI_SCHEME_COAPS_TCP:
    if (proto != COAP_PROTO_TLS)
      return 0;
    break;
  case COAP_URI_SCHEME_COAP_WS:
    if (proto != COAP_PROTO_WS)
      return 0;
    break;
  case COAP_URI_SCHEME_COAPS_WS:
    if (proto != COAP_PROTO_WSS)
      return 0;
    break;
  /* Proxy support only */
  case COAP_URI_SCHEME_HTTP:
  case COAP_URI_SCHEME_HTTPS:
  case COAP_URI_SCHEME_LAST:
  default:
    return 0;
  }

  /* construct CoAP message */
  pdu = <a href="man_coap_pdu_init.html#coap_pdu_init" target="_self">coap_pdu_init</a>(COAP_MESSAGE_CON,
                      COAP_REQUEST_CODE_GET,
                      <a href="man_coap_new_message_id.html#coap_new_message_id" target="_self">coap_new_message_id</a>(session),
                      <a href="man_coap_session_max_pdu_size.html#coap_session_max_pdu_size" target="_self">coap_session_max_pdu_size</a>(session));
  if (pdu == NULL)
    return 0;

  /* Create all the necessary options from the URI */
  res = <a href="man_coap_uri_into_options.html#coap_uri_into_options" target="_self">coap_uri_into_options</a>(&amp;uri, dst, &amp;optlist, 1, buf, sizeof(buf));
  if (res != 0)
    return 0;

  /* Add option list (which will get sorted) to the PDU */
  if (optlist) {
    res = <a href="man_coap_add_optlist_pdu.html#coap_add_optlist_pdu" target="_self">coap_add_optlist_pdu</a>(pdu, &amp;optlist);
    <a href="man_coap_delete_optlist.html#coap_delete_optlist" target="_self">coap_delete_optlist</a>(optlist);
    if (res != 1)
      return 0;
  }

  /* and send the PDU */
  mid = <a href="man_coap_send.html#coap_send" target="_self">coap_send</a>(session, pdu);
  if (mid == COAP_INVALID_MID)
    return 0;
  return 1;
}</pre></div><div class="refsect1"><a id="_see_also"></a><h2>SEE ALSO</h2><p><span class="strong"><strong><a class="st-desc" href="man_coap_endpoint_client.html#coap_endpoint_client" target="_self">coap_endpoint_client</a></strong></span>(3) and <span class="strong"><strong><a class="st-desc" href="man_coap_pdu_setup.html#coap_pdu_setup" target="_self">coap_pdu_setup</a></strong></span>(3).</p></div><div class="refsect1"><a id="_further_information"></a><h2>FURTHER INFORMATION</h2><p>See</p><p>"<a class="ulink" href="https://rfc-editor.org/rfc/rfc7252" target="_top">RFC7252: The Constrained Application Protocol (CoAP)</a>"</p><p>for further information.</p></div><div class="refsect1"><a id="_bugs"></a><h2>BUGS</h2><p>Please report bugs on the mailing list for libcoap:
<a class="ulink" href="mailto:libcoap-developers@lists.sourceforge.net" target="_top">libcoap-developers@lists.sourceforge.net</a> or raise an issue on GitHub at
<a class="ulink" href="https://github.com/obgm/libcoap/issues" target="_top">https://github.com/obgm/libcoap/issues</a></p></div><div class="refsect1"><a id="_authors"></a><h2>AUTHORS</h2><p>The libcoap project &lt;<a class="ulink" href="mailto:libcoap-developers@lists.sourceforge.net" target="_top">libcoap-developers@lists.sourceforge.net</a>&gt;</p></div></div></body></html> coap_split_uri(3)</p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Sep 7 2023 15:01:17 for libcoap by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
