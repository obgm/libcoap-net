<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libcoap: coap_register_request_handler(3)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libcoap<span id="projectnumber">&#160;4.3.5</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('man_coap_register_request_handler.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">coap_register_request_handler(3)</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>coap_handler</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /></head><body><div xml:lang="en" class="refentry" lang="en"><a id="idm1"></a><div class="titlepage"></div><div class="refnamediv"><h2>NAME</h2><p><a href="man_coap_handler.html#coap_handler" target="_self">coap_handler</a>, <a href="man_coap_register_request_handler.html#coap_register_request_handler" target="_self"><span class="man-highlight">coap_register_request_handler</span></a>, <a href="man_coap_register_response_handler.html#coap_register_response_handler" target="_self">coap_register_response_handler</a>, <a href="man_coap_register_nack_handler.html#coap_register_nack_handler" target="_self">coap_register_nack_handler</a>, <a href="man_coap_register_ping_handler.html#coap_register_ping_handler" target="_self">coap_register_ping_handler</a>, <a href="man_coap_register_pong_handler.html#coap_register_pong_handler" target="_self">coap_register_pong_handler</a>, <a href="man_coap_register_event_handler.html#coap_register_event_handler" target="_self">coap_register_event_handler</a> - Work with CoAP handlers </p></div><div class="refsynopsisdiv"><a id="_synopsis"></a><h2>SYNOPSIS</h2><p><span class="strong"><strong>#include &lt;coap3/coap.h&gt;</strong></span></p><p><span class="strong"><strong>void <a class="st-synopsis" href="man_coap_register_request_handler.html#coap_register_request_handler" target="_self"><span class="man-highlight">coap_register_request_handler</span></a>(coap_resource_t *<span class="emphasis"><em>resource</em></span>,
coap_request_t <span class="emphasis"><em>method</em></span>, coap_method_handler_t <span class="emphasis"><em>handler</em></span>);</strong></span></p><p><span class="strong"><strong>void <a class="st-synopsis" href="man_coap_register_response_handler.html#coap_register_response_handler" target="_self">coap_register_response_handler</a>(coap_context_t *<span class="emphasis"><em>context</em></span>,
coap_response_handler_t <span class="emphasis"><em>handler</em></span>)</strong></span>;</p><p><span class="strong"><strong>void <a class="st-synopsis" href="man_coap_register_nack_handler.html#coap_register_nack_handler" target="_self">coap_register_nack_handler</a>(coap_context_t *<span class="emphasis"><em>context</em></span>,
coap_nack_handler_t <span class="emphasis"><em>handler</em></span>)</strong></span>;</p><p><span class="strong"><strong>void <a class="st-synopsis" href="man_coap_register_ping_handler.html#coap_register_ping_handler" target="_self">coap_register_ping_handler</a>(coap_context_t *<span class="emphasis"><em>context</em></span>,
coap_ping_handler_t <span class="emphasis"><em>handler</em></span>)</strong></span>;</p><p><span class="strong"><strong>void <a class="st-synopsis" href="man_coap_register_pong_handler.html#coap_register_pong_handler" target="_self">coap_register_pong_handler</a>(coap_context_t *<span class="emphasis"><em>context</em></span>,
coap_pong_handler_t <span class="emphasis"><em>handler</em></span>)</strong></span>;</p><p><span class="strong"><strong>void <a class="st-synopsis" href="man_coap_register_event_handler.html#coap_register_event_handler" target="_self">coap_register_event_handler</a>(coap_context_t *<span class="emphasis"><em>context</em></span>,
coap_event_handler_t <span class="emphasis"><em>handler</em></span>)</strong></span>;</p><p>For specific (D)TLS library support, link with
<span class="strong"><strong>-lcoap-3-notls</strong></span>, <span class="strong"><strong>-lcoap-3-gnutls</strong></span>,
<span class="strong"><strong>-lcoap-3-openssl</strong></span>, <span class="strong"><strong>-lcoap-3-mbedtls</strong></span>,
<span class="strong"><strong>-lcoap-3-wolfssl</strong></span>
or <span class="strong"><strong>-lcoap-3-tinydtls</strong></span>.   Otherwise, link with
<span class="strong"><strong>-lcoap-3</strong></span> to get the default (D)TLS library support.</p></div><div class="refsect1"><a id="_description"></a><h2>DESCRIPTION</h2><p>This documents the different callback handlers that can optionally be invoked
on receipt of a packet or when a timeout occurs.</p></div><div class="refsect1"><a id="_functions"></a><h2>FUNCTIONS</h2><p><span class="strong"><strong><a class="anchor" id="coap_register_request_handler"></a>Function: <a href="man_coap_register_request_handler.html#coap_register_request_handler" target="_self"><span class="man-highlight">coap_register_request_handler</span></a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_register_request_handler.html#coap_register_request_handler" target="_self"><span class="man-highlight">coap_register_request_handler</span></a></strong></span>() is a server side function that registers
a callback handler <span class="emphasis"><em>handler</em></span> that is called when there is an incoming request
PDU, there is a URI match against the <span class="emphasis"><em>resource</em></span> and there is a <span class="emphasis"><em>method</em></span>
(e.g. PUT, POST etc.) match. <span class="emphasis"><em>method</em></span> can be one of the following.</p><pre class="screen">COAP_REQUEST_GET
COAP_REQUEST_POST
COAP_REQUEST_PUT
COAP_REQUEST_DELETE
COAP_REQUEST_FETCH
COAP_REQUEST_PATCH
COAP_REQUEST_IPATCH</pre><p>The request handler function prototype is defined as:</p><pre class="programlisting">/**
 * Definition of message handler function
 *
 * @param resource The resource being requested.
 * @param session The CoAP session.
 * @param request The request PDU.
 * @param query The query string for the resource.
 * @param response The pre-populated response PDU.
 */
typedef void (*coap_method_handler_t)(coap_resource_t *resource,
                                      coap_session_t *session,
                                      const coap_pdu_t *request,
                                      const coap_string_t *query,
                                      coap_pdu_t *response);</pre><p>In <span class="emphasis"><em>handler</em></span>, data from <span class="emphasis"><em>incoming_pdu</em></span> can be abstracted as described in
<span class="strong"><strong><a class="st-desc" href="man_coap_pdu_access.html#coap_pdu_access" target="_self">coap_pdu_access</a></strong></span>(3) for analysis and then the <span class="emphasis"><em>handler</em></span> updates
<span class="emphasis"><em>response_pdu</em></span> as appropriate as described in <span class="strong"><strong><a class="st-desc" href="man_coap_pdu_setup.html#coap_pdu_setup" target="_self">coap_pdu_setup</a></strong></span>(3),
including the response code.  If <span class="emphasis"><em>response_pdu</em></span>'s code is not updated, then
<span class="emphasis"><em>response_pdu</em></span> will not get sent back to the client.</p><p><span class="emphasis"><em>response_pdu</em></span> is already
pre-populated with the <span class="emphasis"><em>incoming_pdu</em></span>'s token and the PDU type.  If
<span class="emphasis"><em>handler</em></span> is called as a result of an unsolicited Observe trigger, then the
Observe option (and potentially Block2 option) are also added in.  The
<span class="emphasis"><em>response_pdu</em></span>'s response code should always be updated.</p><p>This <span class="emphasis"><em>handler</em></span> must not call <span class="strong"><strong><a class="st-desc" href="man_coap_send.html#coap_send" target="_self">coap_send</a></strong></span>(3) to send <span class="emphasis"><em>response_pdu</em></span>.
<span class="emphasis"><em>response_pdu</em></span> gets sent on return from <span class="emphasis"><em>handler</em></span>, assuming the response
code has been updated. If the response code was not updated, then an empty
ACK packet will get sent for CON type requests or nothing for NON type
requests.</p><p><span class="strong"><strong>NOTE:</strong></span> Any data associated with <span class="emphasis"><em>incoming_pdu</em></span> is no longer be available after
exiting this function as <span class="emphasis"><em>incoming_pdu</em></span> is deleted.  In particular
<span class="emphasis"><em>incoming_pdu</em></span>'s data must not be used if calling
<span class="strong"><strong><a class="st-desc" href="man_coap_add_data_large_response.html#coap_add_data_large_response" target="_self">coap_add_data_large_response</a></strong></span>(). However, it is safe to use the data if
<span class="strong"><strong><a class="st-desc" href="man_coap_add_data.html#coap_add_data" target="_self">coap_add_data</a></strong></span>() is used to update <span class="emphasis"><em>response_pdu</em></span> where a copy of the data is
taken.</p><p><span class="strong"><strong>NOTE:</strong></span> A request callback handler can be called with a generic resource (i.e.
set up using <span class="strong"><strong><a class="st-desc" href="man_coap_resource_unknown_init2.html#coap_resource_unknown_init2" target="_self">coap_resource_unknown_init2</a></strong></span>(3)), so
<span class="strong"><strong><a class="st-desc" href="man_coap_resource_get_uri_path.html#coap_resource_get_uri_path" target="_self">coap_resource_get_uri_path</a></strong></span>(3) can be used to determine the URI in this case.</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_register_response_handler.html#coap_register_response_handler" target="_self">coap_register_response_handler</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_register_response_handler.html#coap_register_response_handler" target="_self">coap_register_response_handler</a></strong></span>() is a client side function that registers
a request’s response callback <span class="emphasis"><em>handler</em></span> for traffic associated with the
<span class="emphasis"><em>context</em></span>.  The application can use this for handling any response packets,
including sending a RST packet if this response was unexpected.  If <span class="emphasis"><em>handler</em></span>
is NULL, then the handler is de-registered.</p><p>The response handler function prototype is defined as:</p><pre class="programlisting">typedef enum coap_response_t {
  COAP_RESPONSE_FAIL, /* Response not liked - send CoAP RST packet */
  COAP_RESPONSE_OK    /* Response is fine */
} coap_response_t;

/**
 * Response handler that is used as callback in coap_context_t.
 *
 * @param session CoAP session.
 * @param sent The PDU that was transmitted.
 * @param received The PDU that was received.
 * @param mid CoAP transaction ID.
 *
 * @return @c COAP_RESPONSE_OK if successful, else @c COAP_RESPONSE_FAIL which
 *         triggers sending a RST packet if the received PDU is a CON or NON.
 */
typedef coap_response_t (*coap_response_handler_t)(coap_session_t *session,
                                                   const coap_pdu_t *sent,
                                                   const coap_pdu_t *received,
                                                   const coap_mid_t mid);</pre><p>In <span class="emphasis"><em>handler</em></span>, data from <span class="emphasis"><em>received</em></span> (and optionally <span class="emphasis"><em>sent</em></span> if set) can be
abstracted as described in <span class="strong"><strong><a class="st-desc" href="man_coap_pdu_access.html#coap_pdu_access" target="_self">coap_pdu_access</a></strong></span>(3) for analysis.</p><p><span class="strong"><strong>NOTE:</strong></span> <span class="emphasis"><em>sent</em></span> will only be non NULL when the request PDU is Confirmable and
this is an ACK or RST response to the request.  In general, matching of
Requests and Responses whould be done by generating unique Tokens for each
Request and then matching up based on the Token in <span class="emphasis"><em>received</em></span> Response.</p><p><span class="strong"><strong>NOTE:</strong></span> <span class="emphasis"><em>sent</em></span> (if not NULL) may not contain all or any of the data used for the
initial request if block transfers are being used. For Block1 requests, the
complete data will be lost once the data has been successfully transmitted as
acknowledged by the first response. For Block2 responses, <span class="emphasis"><em>sent</em></span> gets re-used
to request the next Block2 and so data information is lost.</p><p><span class="strong"><strong>NOTE:</strong></span> If the returned value is COAP_RESPONSE_FAIL, then a CoAP RST packet
will get sent to the server by libcoap.  The returned value of COAP_RESPONSE_OK
indicates that all is OK.</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_register_nack_handler.html#coap_register_nack_handler" target="_self">coap_register_nack_handler</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_register_nack_handler.html#coap_register_nack_handler" target="_self">coap_register_nack_handler</a></strong></span>() is a client side function that registers a
request’s negative response callback <span class="emphasis"><em>handler</em></span> for traffic associated with the
<span class="emphasis"><em>context</em></span>.  If <span class="emphasis"><em>handler</em></span> is NULL, then the handler is de-registered.</p><p>The nack handler function prototype is defined as:</p><pre class="programlisting">/**
 * Negative Acknowedge handler that is used as callback in coap_context_t.
 *
 * @param session CoAP session.
 * @param sent The PDU that was transmitted.
 * @param reason The reason for the NACK.
 * @param mid CoAP message ID.
 */
typedef void (*coap_nack_handler_t)(coap_session_t *session,
                                    const coap_pdu_t *sent,
                                    const coap_nack_reason_t reason,
                                    const coap_mid_t mid);</pre><p>NACK <span class="emphasis"><em>reason</em></span> can be one of the following</p><pre class="screen">typedef enum {
  COAP_NACK_TOO_MANY_RETRIES,
  COAP_NACK_NOT_DELIVERABLE,
  COAP_NACK_RST,
  COAP_NACK_TLS_FAILED,
  COAP_NACK_ICMP_ISSUE,
  COAP_NACK_BAD_RESPONSE,
  COAP_NACK_TLS_LAYER_FAILED,
  COAP_NACK_WS_LAYER_FAILED,
  COAP_NACK_WS_FAILED
} coap_nack_reason_t;</pre><p><span class="emphasis"><em>sent</em></span> can be NULL.  <span class="emphasis"><em>mid</em></span> can be used for determining which is the transmitting
request.</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_register_ping_handler.html#coap_register_ping_handler" target="_self">coap_register_ping_handler</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_register_ping_handler.html#coap_register_ping_handler" target="_self">coap_register_ping_handler</a></strong></span>() function registers a callback <span class="emphasis"><em>handler</em></span> for
tracking receipt of CoAP ping traffic associated with the <span class="emphasis"><em>context</em></span>. If
<span class="emphasis"><em>handler</em></span> is NULL, then the handler is de-registered. It can be used both
client and server side.</p><p>The ping handler function prototype is defined as:</p><pre class="programlisting">/**
 * Received Ping handler that is used as callback in coap_context_t.
 *
 * @param session CoAP session.
 * @param received The PDU that was received.
 * @param mid CoAP message ID.
 */
typedef void (*coap_ping_handler_t)(coap_session_t *session,
                                    const coap_pdu_t *received,
                                    const coap_mid_t mid);</pre><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_register_pong_handler.html#coap_register_pong_handler" target="_self">coap_register_pong_handler</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_register_pong_handler.html#coap_register_pong_handler" target="_self">coap_register_pong_handler</a></strong></span>() function registers a callback <span class="emphasis"><em>handler</em></span> for
tracking receipt of CoAP ping response traffic associated with the <span class="emphasis"><em>context</em></span>.
If <span class="emphasis"><em>handler</em></span> is NULL, then the handler is de-registered. It can be used both
client and server side.</p><p>The pong handler function prototype is defined as:</p><pre class="programlisting">/**
 * Received Pong handler that is used as callback in coap_context_t.
 *
 * @param session CoAP session.
 * @param received The PDU that was received.
 * @param mid CoAP message ID.
 */
typedef void (*coap_pong_handler_t)(coap_session_t *session,
                                    const coap_pdu_t *received,
                                    const coap_mid_t mid);</pre><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_register_event_handler.html#coap_register_event_handler" target="_self">coap_register_event_handler</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_register_event_handler.html#coap_register_event_handler" target="_self">coap_register_event_handler</a></strong></span>() function registers a callback <span class="emphasis"><em>handler</em></span>
for tracking network events associated with the <span class="emphasis"><em>context</em></span>. If <span class="emphasis"><em>handler</em></span> is
NULL, then the handler is de-registered. It can be used both client and server
side.</p><p>The event handler function prototype is defined as:</p><pre class="programlisting">/**
 * Type for event handler functions that can be registered with a CoAP
 * context using the function <a href="man_coap_set_event_handler.html#coap_set_event_handler" target="_self">coap_set_event_handler</a>().
 *
 * @param session The current CoAP session.
 * @param event The event type that has occurred.
 *
 * @return @c 0 No further action required by libcoap
 *         @c 1 Depending from where called, libcoap may take further
 *              action (reserved for future use)
 */
typedef int (*coap_event_handler_t)(coap_session_t *session,
                                    const coap_event_t event);</pre><p>Events can be one of the following</p><pre class="screen">/**
 * Scalar type to represent different events, e.g. DTLS events or
 * retransmission timeouts.
 */
typedef enum {
  /*
   * (D)TLS events for COAP_PROTO_DTLS and COAP_PROTO_TLS
   */
  /** Triggerred when (D)TLS session closed */
  COAP_EVENT_DTLS_CLOSED       = 0x0000,
  /** Triggered when (D)TLS session connected */
  COAP_EVENT_DTLS_CONNECTED    = 0x01DE,
  /** Triggered when (D)TLS session renegotiated */
  COAP_EVENT_DTLS_RENEGOTIATE  = 0x01DF,
  /** Triggered when (D)TLS error occurs */
  COAP_EVENT_DTLS_ERROR        = 0x0200,

  /*
   * TCP events for COAP_PROTO_TCP and COAP_PROTO_TLS
   */
  /** Triggered when TCP layer connects */
  COAP_EVENT_TCP_CONNECTED     = 0x1001,
  /** Triggered when TCP layer is closed */
  COAP_EVENT_TCP_CLOSED        = 0x1002,
  /** Triggered when TCP layer fails for some reason */
  COAP_EVENT_TCP_FAILED        = 0x1003,

  /*
   * CSM exchange events for reliable protocols only
   */
  /** Triggered when TCP layer completes exchange of CSM information */
  COAP_EVENT_SESSION_CONNECTED = 0x2001,
  /** Triggered when TCP layer closes following exchange of CSM information */
  COAP_EVENT_SESSION_CLOSED    = 0x2002,
  /** Triggered when TCP layer fails  following exchange of CSM information */
  COAP_EVENT_SESSION_FAILED    = 0x2003,

  /*
   * (Q-)Block errors
   */
  /** Triggered when not all of a large body has been received */
  COAP_EVENT_PARTIAL_BLOCK     = 0x3001,
  /** Triggered when not all of a large body has been transmitted */
  COAP_EVENT_XMIT_BLOCK_FAIL   = 0x3002,

  /*
   * Server session events
   */
  /**
   * Called in the CoAP IO loop if a new *server-side* session is created due
   * to an incoming connection.
   *
   * Note that the session might not be a fully established connection yet,
   * it might also refer to, e.g., a DTLS session in a handshake stage.
   */
  COAP_EVENT_SERVER_SESSION_NEW = 0x4001,

  /**
   * Called in the CoAP IO loop if a server session is deleted (e.g., due to
   * inactivity or because the maximum number of idle sessions was exceeded).
   *
   * The session will still contain valid data when the event handler is
   * called.
   */
  COAP_EVENT_SERVER_SESSION_DEL = 0x4002,

  /*
   * Message receive and transmit events
   */
  /** Triggered when badly formatted packet received */
  COAP_EVENT_BAD_PACKET         = 0x5001,
  /** Triggered when a message is retransmitted */
  COAP_EVENT_MSG_RETRANSMITTED  = 0x5002,

  /*
   * OSCORE events
   */
  /** Triggered when there is an OSCORE decryption failure */
  COAP_EVENT_OSCORE_DECRYPTION_FAILURE = 0x6001,
  /** Triggered when trying to use OSCORE to decrypt, but it is not enabled */
  COAP_EVENT_OSCORE_NOT_ENABLED,
  /** Triggered when there is no OSCORE encrypted payload provided */
  COAP_EVENT_OSCORE_NO_PROTECTED_PAYLOAD,
  /** Triggered when there is no OSCORE security definition found */
  COAP_EVENT_OSCORE_NO_SECURITY,
  /** Triggered when there is an OSCORE internal error i.e malloc failed */
  COAP_EVENT_OSCORE_INTERNAL_ERROR,
  /** Triggered when there is an OSCORE decode of OSCORE option failure */
  COAP_EVENT_OSCORE_DECODE_ERROR,
  /*
   * WebSocket events
   */
  /** Triggered when there is an oversize WebSockets packet */
  COAP_EVENT_WS_PACKET_SIZE = 0x7001,
  /** Triggered when the WebSockets layer is up */
  COAP_EVENT_WS_CONNECTED,
  /** Triggered when the WebSockets layer is closed */
  COAP_EVENT_WS_CLOSED,
  /*
   * Keepalive events
   */
  /** Triggered when no response to a keep alive (ping) packet */
  COAP_EVENT_KEEPALIVE_FAILURE = 0x8001,
} coap_event_t;</pre></div><div class="refsect1"><a id="_examples"></a><h2>EXAMPLES</h2><p><span class="strong"><strong>GET Resource Callback Handler</strong></span></p><pre class="programlisting">#include &lt;coap3/coap.h&gt;

#include &lt;stdio.h&gt;

static void
hnd_get_time(coap_resource_t *resource, coap_session_t *session,
             coap_pdu_t *request, coap_string_t *query,
             coap_pdu_t *response) {
  unsigned char buf[40];
  size_t len;
  time_t now;

  /* ... Additional analysis code for resource, request pdu etc.  ... */

  /* After analysis, generate a suitable response */

  now = time(NULL);

  if (query != NULL &amp;&amp; <a href="man_coap_string_equal.html#coap_string_equal" target="_self">coap_string_equal</a>(query, <a href="man_coap_make_str_const.html#coap_make_str_const" target="_self">coap_make_str_const</a>("secs"))) {
    /* Output secs since Jan 1 1970 */
    len = snprintf((char *)buf, sizeof(buf), "%lu", now);
  } else {
    /* Output human-readable time */
    struct tm *tmp;
    tmp = gmtime(&amp;now);
    if (!tmp) {
      /* If 'now' is not valid */
      <a href="man_coap_pdu_set_code.html#coap_pdu_set_code" target="_self">coap_pdu_set_code</a>(response, COAP_RESPONSE_CODE_NOT_FOUND);
      return;
    }
    len = strftime((char *)buf, sizeof(buf), "%b %d %H:%M:%S", tmp);
  }
  <a href="man_coap_pdu_set_code.html#coap_pdu_set_code" target="_self">coap_pdu_set_code</a>(response, COAP_RESPONSE_CODE_CONTENT);
  /*
   * Invoke <a href="man_coap_add_data_large_response.html#coap_add_data_large_response" target="_self">coap_add_data_large_response</a>() to do all the hard work.
   *
   * Define the format - COAP_MEDIATYPE_TEXT_PLAIN - to add in
   * Define how long this response is valid for (secs) - 1 - to add in.
   *
   * Observe Option added internally if needed within the function
   * Block2 Option added internally if output too large
   * ETag Option added internally
   */
  <a href="man_coap_add_data_large_response.html#coap_add_data_large_response" target="_self">coap_add_data_large_response</a>(resource, session, request, response,
                               query, COAP_MEDIATYPE_TEXT_PLAIN, 1, 0,
                               len,
                               buf, NULL, 0);

}</pre><p><span class="strong"><strong>Packet Response Handler</strong></span></p><pre class="programlisting">#include &lt;coap3/coap.h&gt;

static int
check_token(coap_pdu_t *received) {
  /* Remove (void) definition if variable is used */
  (void)received;

  /* Code to validate the token is what we expect */

  return 1;
}

static coap_response_t
response_handler(coap_context_t *ctx, coap_session_t *session,
                 coap_pdu_t *sent, coap_pdu_t *received,
                 const coap_mid_t mid) {
  /* Remove (void) definition if variable is used */
  (void)ctx;
  (void)session;
  (void)mid;
  coap_pdu_type_t rcv_type = <a href="man_coap_pdu_get_type.html#coap_pdu_get_type" target="_self">coap_pdu_get_type</a>(received);
  coap_pdu_code_t rcv_code = <a href="man_coap_pdu_get_code.html#coap_pdu_get_code" target="_self">coap_pdu_get_code</a>(received);

  /* check if this is a response to our original request */
  if (!check_token(received)) {
    /* drop if this was just some message, or send RST in case of notification */
    if (!sent &amp;&amp; (rcv_type == COAP_MESSAGE_CON ||
                  rcv_type == COAP_MESSAGE_NON)) {
      /* Cause a CoAP RST to be sent */
      return COAP_RESPONSE_FAIL;
    }
    return COAP_RESPONSE_OK;
  }

  if (rcv_type == COAP_MESSAGE_RST) {
    <a href="man_coap_log_info.html#coap_log_info" target="_self">coap_log_info</a>("got RST\n");
    return COAP_RESPONSE_OK;
  }

  /* Output the received data, if any */
  if (COAP_RESPONSE_CLASS(rcv_code) == 2) {
    /* Additional code to deal with the response */

  }
  return COAP_RESPONSE_OK;

}</pre></div><div class="refsect1"><a id="_see_also"></a><h2>SEE ALSO</h2><p><span class="strong"><strong><a class="st-desc" href="man_coap_block.html#coap_block" target="_self">coap_block</a></strong></span>(3), <span class="strong"><strong><a class="st-desc" href="man_coap_observe.html#coap_observe" target="_self">coap_observe</a></strong></span>(3), <span class="strong"><strong><a class="st-desc" href="man_coap_pdu_access.html#coap_pdu_access" target="_self">coap_pdu_access</a></strong></span>(3), <span class="strong"><strong><a class="st-desc" href="man_coap_pdu_setup.html#coap_pdu_setup" target="_self">coap_pdu_setup</a></strong></span>(3)
and <span class="strong"><strong><a class="st-desc" href="man_coap_resource.html#coap_resource" target="_self">coap_resource</a></strong></span>(3)</p></div><div class="refsect1"><a id="_further_information"></a><h2>FURTHER INFORMATION</h2><p>See</p><p>"<a class="ulink" href="https://rfc-editor.org/rfc/rfc7252" target="_top">RFC7252: The Constrained Application Protocol (CoAP)</a>"</p><p>for further information.</p></div><div class="refsect1"><a id="_bugs"></a><h2>BUGS</h2><p>Please raise an issue on GitHub at
<a class="ulink" href="https://github.com/obgm/libcoap/issues" target="_top">https://github.com/obgm/libcoap/issues</a> to report any bugs.</p><p>Please raise a Pull Request at <a class="ulink" href="https://github.com/obgm/libcoap/pulls" target="_top">https://github.com/obgm/libcoap/pulls</a>
for any fixes.</p></div><div class="refsect1"><a id="_authors"></a><h2>AUTHORS</h2><p>The libcoap project &lt;<a class="ulink" href="mailto:libcoap-developers@lists.sourceforge.net" target="_top">libcoap-developers@lists.sourceforge.net</a>&gt;</p></div></div></body></html> coap_register_request_handler(3)</p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Sep 7 2024 00:02:05 for libcoap by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
