<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libcoap: coap_tls_engine_configure(3)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libcoap<span id="projectnumber">&#160;4.3.5</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('man_coap_tls_engine_configure.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">coap_tls_engine_configure(3)</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>coap_tls_library</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /></head><body><div xml:lang="en" class="refentry" lang="en"><a id="idm1"></a><div class="titlepage"></div><div class="refnamediv"><h2>NAME</h2><p><a href="man_coap_tls_library.html#coap_tls_library" target="_self">coap_tls_library</a>, <a href="man_coap_get_tls_library_version.html#coap_get_tls_library_version" target="_self">coap_get_tls_library_version</a>, <a href="man_coap_string_tls_support.html#coap_string_tls_support" target="_self">coap_string_tls_support</a>, <a href="man_coap_string_tls_version.html#coap_string_tls_version" target="_self">coap_string_tls_version</a>, <a href="man_coap_show_tls_version.html#coap_show_tls_version" target="_self">coap_show_tls_version</a>, <a href="man_coap_tls_engine_configure.html#coap_tls_engine_configure" target="_self"><span class="man-highlight">coap_tls_engine_configure</span></a>, <a href="man_coap_tls_engine_remove.html#coap_tls_engine_remove" target="_self">coap_tls_engine_remove</a> - Work with CoAP TLS libraries </p></div><div class="refsynopsisdiv"><a id="_synopsis"></a><h2>SYNOPSIS</h2><p><span class="strong"><strong>#include &lt;coap3/coap.h&gt;</strong></span></p><p><span class="strong"><strong>coap_tls_version_t *<a class="st-synopsis" href="man_coap_get_tls_library_version.html#coap_get_tls_library_version" target="_self">coap_get_tls_library_version</a>(void);</strong></span></p><p><span class="strong"><strong>char *<a class="st-synopsis" href="man_coap_string_tls_support.html#coap_string_tls_support" target="_self">coap_string_tls_support</a>(char *<span class="emphasis"><em>buffer</em></span>, size_t <span class="emphasis"><em>bufsize</em></span>);</strong></span></p><p><span class="strong"><strong>char *<a class="st-synopsis" href="man_coap_string_tls_version.html#coap_string_tls_version" target="_self">coap_string_tls_version</a>(char *<span class="emphasis"><em>buffer</em></span>, size_t <span class="emphasis"><em>bufsize</em></span>);</strong></span></p><p><span class="strong"><strong>void <a class="st-synopsis" href="man_coap_show_tls_version.html#coap_show_tls_version" target="_self">coap_show_tls_version</a>(coap_log_t <span class="emphasis"><em>level</em></span>);</strong></span></p><p><span class="strong"><strong>int <a class="st-synopsis" href="man_coap_tls_engine_configure.html#coap_tls_engine_configure" target="_self"><span class="man-highlight">coap_tls_engine_configure</span></a>(coap_str_const_t *<span class="emphasis"><em>conf_mem</em></span>);</strong></span></p><p><span class="strong"><strong>int <a class="st-synopsis" href="man_coap_tls_engine_remove.html#coap_tls_engine_remove" target="_self">coap_tls_engine_remove</a>(void);</strong></span></p><p>For specific (D)TLS library support, link with
<span class="strong"><strong>-lcoap-3-notls</strong></span>, <span class="strong"><strong>-lcoap-3-gnutls</strong></span>,
<span class="strong"><strong>-lcoap-3-openssl</strong></span>, <span class="strong"><strong>-lcoap-3-mbedtls</strong></span>,
<span class="strong"><strong>-lcoap-3-wolfssl</strong></span>
or <span class="strong"><strong>-lcoap-3-tinydtls</strong></span>.   Otherwise, link with
<span class="strong"><strong>-lcoap-3</strong></span> to get the default (D)TLS library support.</p></div><div class="refsect1"><a id="_description"></a><h2>DESCRIPTION</h2><p>When the libcoap library was built, it will have been compiled using a
specific TLS implementation type (e.g. <a class="ulink" href="https://www.openssl.org" target="_top">OpenSSL</a>,
<a class="ulink" href="https://www.gnutls.org" target="_top">GnuTLS</a>,
<a class="ulink" href="https://www.trustedfirmware.org/projects/mbed-tls/" target="_top">Mbed TLS</a>,
<a class="ulink" href="https://wolfssl.com" target="_top">wolfSSL</a>,
<a class="ulink" href="https://github.com/eclipse/tinydtls" target="_top">TinyDTLS</a> or noTLS).
When the libcoap library is linked into an application, it is possible that
the application needs to dynamically determine whether DTLS or TLS is
supported, what type of TLS implementation libcoap was compiled with, as well
as detect what is the version of the currently loaded TLS library is.</p><p><span class="strong"><strong>NOTE:</strong></span> If OpenSSL is being used, then the minimum OpenSSL library version is
1.1.0.</p><p><span class="strong"><strong>NOTE:</strong></span> If GnuTLS is being used, then the minimum GnuTLS library version is
3.3.0.</p><p><span class="strong"><strong>NOTE:</strong></span> If GnuTLS is going to interoperate with TinyDTLS, then a minimum
revision of GnuTLS 3.5.5 which supports CCM algorithms is required
by TinyDTLS as TinyDTLS currently only supports CCM.</p><p>Network traffic can be encrypted or un-encrypted with libcoap - how to set
this up is described in <span class="strong"><strong><a class="st-desc" href="man_coap_context.html#coap_context" target="_self">coap_context</a></strong></span>(3).</p><p>Due to the nature of TLS, there can be Callbacks that are invoked as the TLS
session negotiates encryption algorithms, encryption keys etc.
Where possible, by default, the CoAP layer handles all this automatically.
However, there is the flexibility of the Callbacks for imposing additional
security checks etc. when PKI is being used.  These callbacks need to need to
match the TLS implementation type.</p></div><div class="refsect1"><a id="_functions"></a><h2>FUNCTIONS</h2><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_get_tls_library_version.html#coap_get_tls_library_version" target="_self">coap_get_tls_library_version</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_get_tls_library_version.html#coap_get_tls_library_version" target="_self">coap_get_tls_library_version</a></strong></span>() function returns the TLS implementation
type and library version in a coap_tls_version_t* structure.</p><pre class="programlisting">typedef enum coap_tls_library_t {
  COAP_TLS_LIBRARY_NOTLS = 0, /* No DTLS library */
  COAP_TLS_LIBRARY_TINYDTLS,  /* Using TinyDTLS library */
  COAP_TLS_LIBRARY_OPENSSL,   /* Using OpenSSL library */
  COAP_TLS_LIBRARY_GNUTLS,    /* Using GnuTLS library */
  COAP_TLS_LIBRARY_MBEDTLS,   /* Using Mbed TLS library */
  COAP_TLS_LIBRARY_WOLFSSL,   /* Using wolfSSL library */
} coap_tls_library_t;

typedef struct coap_tls_version_t {
  uint64_t version;        /* (D)TLS runtime Library Version */
  coap_tls_library_t type; /* Library type. One of COAP_TLS_LIBRARY_* */
  uint64_t built_version;  /* (D)TLS Built against Library Version */
}</pre><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_string_tls_support.html#coap_string_tls_support" target="_self">coap_string_tls_support</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_string_tls_support.html#coap_string_tls_support" target="_self">coap_string_tls_support</a></strong></span>() function is used to update the provided buffer
with ascii readable information about what type of PSK, PKI etc. keys the
current (D)TLS library supports.
<span class="emphasis"><em>buffer</em></span> defines the buffer to provide the information and <span class="emphasis"><em>bufsize</em></span> is the
size of <span class="emphasis"><em>buffer</em></span>.</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_string_tls_version.html#coap_string_tls_version" target="_self">coap_string_tls_version</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_string_tls_version.html#coap_string_tls_version" target="_self">coap_string_tls_version</a></strong></span>() function is used to update the provided buffer
with information about the current (D)TLS library that libcoap was built
against, as well as the current linked version of the (D)TLS library.
<span class="emphasis"><em>buffer</em></span> defines the buffer to provide the information and <span class="emphasis"><em>bufsize</em></span> is the
size of <span class="emphasis"><em>buffer</em></span>.</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_show_tls_version.html#coap_show_tls_version" target="_self">coap_show_tls_version</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_show_tls_version.html#coap_show_tls_version" target="_self">coap_show_tls_version</a></strong></span>() function is used log information about the
current (D)TLS library that libcoap was built against, as well as the current
linked version of the (D)TLS library. <span class="emphasis"><em>level</em></span> defines the minimum logging level
for this information to be output using <a href="man_coap_log.html#coap_log" target="_self">coap_log</a>().</p><p><span class="strong"><strong><a class="anchor" id="coap_tls_engine_configure"></a>Function: <a href="man_coap_tls_engine_configure.html#coap_tls_engine_configure" target="_self"><span class="man-highlight">coap_tls_engine_configure</span></a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_tls_engine_configure.html#coap_tls_engine_configure" target="_self"><span class="man-highlight">coap_tls_engine_configure</span></a></strong></span>() function is used to configure a TLS ENGINE
(currently only OpenSSL).  It parses the provided configuration in <span class="emphasis"><em>conf_mem</em></span>
and initializes the ENGINE appropriately. The format of the parameters is
documented in <span class="strong"><strong>coap-tls-engine-conf</strong></span>(5).</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_tls_engine_remove.html#coap_tls_engine_remove" target="_self">coap_tls_engine_remove</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_tls_engine_remove.html#coap_tls_engine_remove" target="_self">coap_tls_engine_remove</a></strong></span>() function removes a previously configured TLS
ENGINE.  This function is called when <a href="man_coap_free_context.html#coap_free_context" target="_self">coap_free_context</a>() is called.</p></div><div class="refsect1"><a id="_return_values"></a><h2>RETURN VALUES</h2><p><span class="strong"><strong><a class="st-desc" href="man_coap_get_tls_library_version.html#coap_get_tls_library_version" target="_self">coap_get_tls_library_version</a></strong></span>() returns the TLS implementation type
and library version in a coap_tls_version_t* structure.</p><p><span class="strong"><strong><a class="st-desc" href="man_coap_string_tls_version.html#coap_string_tls_version" target="_self">coap_string_tls_version</a></strong></span>() and <span class="strong"><strong><a class="st-desc" href="man_coap_string_tls_support.html#coap_string_tls_support" target="_self">coap_string_tls_support</a></strong></span>() return
a pointer to the provided buffer.</p><p><span class="strong"><strong><a class="st-desc" href="man_coap_tls_engine_configure.html#coap_tls_engine_configure" target="_self"><span class="man-highlight">coap_tls_engine_configure</span></a></strong></span>() returns 1 if the TLS ENGINE was successfully configured, otherwise 0.</p><p><span class="strong"><strong><a class="st-desc" href="man_coap_tls_engine_remove.html#coap_tls_engine_remove" target="_self">coap_tls_engine_remove</a></strong></span>() returns 1 if the TLS ENGINE was successfully removed, otherwise 0.</p></div><div class="refsect1"><a id="_examples"></a><h2>EXAMPLES</h2><p>*CoAP Server DTLS PKI Setup with OpenSSL Engine *</p><pre class="programlisting">#include &lt;coap3/coap.h&gt;

#define ENGINE_CONFIG \
  "engine:pkcs11\n" \
  "enable-methods:0xffff\n" \
  "post-cmd:PIN:1234\n"

/*
 * Set up PKI encryption information
 */
static coap_context_t *
setup_server_context_pki(const char *public_cert_file,
                         const char *private_key,
                         const char *ca_file) {
  coap_endpoint_t *endpoint;
  coap_address_t listen_addr;
  coap_dtls_pki_t dtls_pki;
  coap_context_t *context;
  coap_str_const_t *engine_conf = <a href="man_coap_make_str_const.html#coap_make_str_const" target="_self">coap_make_str_const</a>(ENGINE_CONFIG);

  /* See <a href="man_coap_supported.html#coap_supported" target="_self">coap_supported</a>(3) */
  if (!<a href="man_coap_dtls_is_supported.html#coap_dtls_is_supported" target="_self">coap_dtls_is_supported</a>())
    return NULL;

  context = <a href="man_coap_new_context.html#coap_new_context" target="_self">coap_new_context</a>(NULL);
  if (!context)
    return NULL;
  /* See <a href="man_coap_block.html#coap_block" target="_self">coap_block</a>(3) */
  <a href="man_coap_context_set_block_mode.html#coap_context_set_block_mode" target="_self">coap_context_set_block_mode</a>(context,
                              COAP_BLOCK_USE_LIBCOAP | COAP_BLOCK_SINGLE_BODY);

  /* To get full logging of any issues here, you need to
   *
   * <a href="man_coap_set_log_level.html#coap_set_log_level" target="_self">coap_set_log_level</a>(COAP_LOG_DEBUG);
   * <a href="man_coap_set_dtls_log_level.html#coap_set_dtls_log_level" target="_self">coap_set_dtls_log_level</a>(COAP_LOG_DEBUG);
   */
  if (!<a href="man_coap_tls_engine_configure.html#coap_tls_engine_configure" target="_self"><span class="man-highlight">coap_tls_engine_configure</span></a>(engine_conf))
    return NULL;

  memset(&amp;dtls_pki, 0, sizeof(dtls_pki));

  /* see <a href="man_coap_encryption.html#coap_encryption" target="_self">coap_encryption</a>(3) */
  dtls_pki.version                 = COAP_DTLS_PKI_SETUP_VERSION;
  dtls_pki.verify_peer_cert        = 1;
  dtls_pki.check_common_ca         = 1;
  dtls_pki.allow_self_signed       = 1;
  dtls_pki.allow_expired_certs     = 1;
  dtls_pki.cert_chain_validation   = 1;
  dtls_pki.cert_chain_verify_depth = 1;
  dtls_pki.check_cert_revocation   = 1;
  dtls_pki.allow_no_crl            = 1;
  dtls_pki.allow_expired_crl       = 1;
  dtls_pki.pki_key.key_type                      = COAP_PKI_KEY_DEFINE;
  dtls_pki.pki_key.key.define.ca.s_byte          = ca_file;
  dtls_pki.pki_key.key.define.public_cert.s_byte = public_cert_file;
  dtls_pki.pki_key.key.define.private_key.s_byte = private_key;
  dtls_pki.pki_key.key.define.public_cert_def    = COAP_PKI_KEY_DEF_PEM;
  dtls_pki.pki_key.key.define.private_key_def    = COAP_PKI_KEY_DEF_ENGINE;
  dtls_pki.pki_key.key.define.ca_def             = COAP_PKI_KEY_DEF_PEM;

  if (<a href="man_coap_context_set_pki.html#coap_context_set_pki" target="_self">coap_context_set_pki</a>(context, &amp;dtls_pki)) {
    <a href="man_coap_free_context.html#coap_free_context" target="_self">coap_free_context</a>(context);
    return NULL;
  }

  /* See <a href="man_coap_address.html#coap_address" target="_self">coap_address</a>(3) */
  <a href="man_coap_address_init.html#coap_address_init" target="_self">coap_address_init</a>(&amp;listen_addr);
  listen_addr.addr.sa.sa_family = AF_INET;
  listen_addr.addr.sin.sin_port = htons(5684);

  endpoint = <a href="man_coap_new_endpoint.html#coap_new_endpoint" target="_self">coap_new_endpoint</a>(context, &amp;listen_addr, COAP_PROTO_DTLS);
  if (!endpoint) {
    <a href="man_coap_free_context.html#coap_free_context" target="_self">coap_free_context</a>(context);
    return NULL;
  }

  /* Initialize resources - See <a href="man_coap_resource.html#coap_resource" target="_self">coap_resource</a>(3) init_resources() example */

  return context;
}</pre></div><div class="refsect1"><a id="_see_also"></a><h2>SEE ALSO</h2><p><span class="strong"><strong><a class="st-desc" href="man_coap_encryption.html#coap_encryption" target="_self">coap_encryption</a></strong></span>(3) and <span class="strong"><strong><a class="st-desc" href="man_coap_supported.html#coap_supported" target="_self">coap_supported</a></strong></span>(3)</p></div><div class="refsect1"><a id="_further_information"></a><h2>FURTHER INFORMATION</h2><p>See</p><p>"<a class="ulink" href="https://rfc-editor.org/rfc/rfc7252" target="_top">RFC7252: The Constrained Application Protocol (CoAP)</a>"</p><p>"<a class="ulink" href="https://rfc-editor.org/rfc/rfc8323" target="_top">RFC8323: CoAP (Constrained Application Protocol) over TCP, TLS, and WebSockets</a>"</p><p>for further information.</p></div><div class="refsect1"><a id="_bugs"></a><h2>BUGS</h2><p>Please raise an issue on GitHub at
<a class="ulink" href="https://github.com/obgm/libcoap/issues" target="_top">https://github.com/obgm/libcoap/issues</a> to report any bugs.</p><p>Please raise a Pull Request at <a class="ulink" href="https://github.com/obgm/libcoap/pulls" target="_top">https://github.com/obgm/libcoap/pulls</a>
for any fixes.</p></div><div class="refsect1"><a id="_authors"></a><h2>AUTHORS</h2><p>The libcoap project &lt;<a class="ulink" href="mailto:libcoap-developers@lists.sourceforge.net" target="_top">libcoap-developers@lists.sourceforge.net</a>&gt;</p></div></div></body></html> coap_tls_engine_configure(3)</p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Sep 7 2024 00:02:05 for libcoap by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
