<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libcoap: coap_oscore_is_supported(3)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libcoap<span id="projectnumber">&#160;4.3.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('man_coap_oscore_is_supported.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">coap_oscore_is_supported(3) </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>coap_oscore</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /></head><body><div xml:lang="en" class="refentry" lang="en"><a id="idm1"></a><div class="titlepage"></div><div class="refnamediv"><h2>NAME</h2><p><a href="man_coap_oscore.html#coap_oscore" target="_self">coap_oscore</a>, <a href="man_coap_oscore_is_supported.html#coap_oscore_is_supported" target="_self"><span class="man-highlight">coap_oscore_is_supported</span></a>, <a href="man_coap_new_oscore_conf.html#coap_new_oscore_conf" target="_self">coap_new_oscore_conf</a>, <a href="man_coap_delete_oscore_conf.html#coap_delete_oscore_conf" target="_self">coap_delete_oscore_conf</a>, <a href="man_coap_new_oscore_recipient.html#coap_new_oscore_recipient" target="_self">coap_new_oscore_recipient</a>, <a href="man_coap_delete_oscore_recipient.html#coap_delete_oscore_recipient" target="_self">coap_delete_oscore_recipient</a>, <a href="man_coap_new_client_session_oscore.html#coap_new_client_session_oscore" target="_self">coap_new_client_session_oscore</a>, <a href="man_coap_new_client_session_oscore_pki.html#coap_new_client_session_oscore_pki" target="_self">coap_new_client_session_oscore_pki</a>, <a href="man_coap_new_client_session_oscore_psk.html#coap_new_client_session_oscore_psk" target="_self">coap_new_client_session_oscore_psk</a>, <a href="man_coap_context_oscore_server.html#coap_context_oscore_server" target="_self">coap_context_oscore_server</a> - Work with CoAP OSCORE </p></div><div class="refsynopsisdiv"><a id="_synopsis"></a><h2>SYNOPSIS</h2><p><span class="strong"><strong>#include &lt;coap3/coap.h&gt;</strong></span></p><p><span class="strong"><strong>int <a class="st-synopsis" href="man_coap_oscore_is_supported.html#coap_oscore_is_supported" target="_self"><span class="man-highlight">coap_oscore_is_supported</span></a>(void);</strong></span></p><p><span class="strong"><strong>coap_oscore_conf_t *<a class="st-synopsis" href="man_coap_new_oscore_conf.html#coap_new_oscore_conf" target="_self">coap_new_oscore_conf</a>(coap_str_const_t <span class="emphasis"><em>conf_mem</em></span>,
coap_oscore_save_seq_num_t <span class="emphasis"><em>save_seq_num_func</em></span>,
void *<span class="emphasis"><em>save_seq_num_func_param</em></span>, uint64_t <span class="emphasis"><em>start_seq_num</em></span>);</strong></span></p><p><span class="strong"><strong>int <a class="st-synopsis" href="man_coap_delete_oscore_conf.html#coap_delete_oscore_conf" target="_self">coap_delete_oscore_conf</a>(coap_oscore_conf_t *<span class="emphasis"><em>oscore_conf</em></span>);</strong></span></p><p><span class="strong"><strong>int <a class="st-synopsis" href="man_coap_new_oscore_recipient.html#coap_new_oscore_recipient" target="_self">coap_new_oscore_recipient</a>(coap_context_t *<span class="emphasis"><em>context</em></span>,
coap_bin_const_t *<span class="emphasis"><em>recipient_id</em></span>);</strong></span></p><p><span class="strong"><strong>int <a class="st-synopsis" href="man_coap_delete_oscore_recipient.html#coap_delete_oscore_recipient" target="_self">coap_delete_oscore_recipient</a>(coap_context_t *<span class="emphasis"><em>context</em></span>,
coap_bin_const_t *<span class="emphasis"><em>recipient_id</em></span>);</strong></span></p><p><span class="strong"><strong>coap_session_t *<a class="st-synopsis" href="man_coap_new_client_session_oscore.html#coap_new_client_session_oscore" target="_self">coap_new_client_session_oscore</a>(coap_context_t *<span class="emphasis"><em>context</em></span>,
const coap_address_t *<span class="emphasis"><em>local_if</em></span>, const coap_address_t *<span class="emphasis"><em>server</em></span>,
coap_proto_t <span class="emphasis"><em>proto</em></span>, coap_oscore_conf_t *<span class="emphasis"><em>oscore_conf</em></span>);</strong></span></p><p><span class="strong"><strong>coap_session_t *<a class="st-synopsis" href="man_coap_new_client_session_oscore_psk.html#coap_new_client_session_oscore_psk" target="_self">coap_new_client_session_oscore_psk</a>(coap_context_t *<span class="emphasis"><em>context</em></span>,
const coap_address_t *<span class="emphasis"><em>local_if</em></span>, const coap_address_t *<span class="emphasis"><em>server</em></span>,
coap_proto_t <span class="emphasis"><em>proto</em></span>, coap_dtls_cpsk_t *<span class="emphasis"><em>psk_data</em></span>,
coap_oscore_conf_t *<span class="emphasis"><em>oscore_conf</em></span>);</strong></span></p><p><span class="strong"><strong>coap_session_t *<a class="st-synopsis" href="man_coap_new_client_session_oscore_pki.html#coap_new_client_session_oscore_pki" target="_self">coap_new_client_session_oscore_pki</a>(coap_context_t *<span class="emphasis"><em>context</em></span>,
const coap_address_t *<span class="emphasis"><em>local_if</em></span>, const coap_address_t *<span class="emphasis"><em>server</em></span>,
coap_proto_t <span class="emphasis"><em>proto</em></span>, coap_dtls_pki_t *<span class="emphasis"><em>pki_data</em></span>,
coap_oscore_conf_t *<span class="emphasis"><em>oscore_conf</em></span>);</strong></span></p><p><span class="strong"><strong>int <a class="st-synopsis" href="man_coap_context_oscore_server.html#coap_context_oscore_server" target="_self">coap_context_oscore_server</a>(coap_context_t *<span class="emphasis"><em>context</em></span>,
coap_oscore_conf_t *<span class="emphasis"><em>oscore_conf</em></span>);</strong></span></p><p>For specific (D)TLS library support, link with
<span class="strong"><strong>-lcoap-3-notls</strong></span>, <span class="strong"><strong>-lcoap-3-gnutls</strong></span>,
<span class="strong"><strong>-lcoap-3-openssl</strong></span>, <span class="strong"><strong>-lcoap-3-mbedtls</strong></span>
or <span class="strong"><strong>-lcoap-3-tinydtls</strong></span>.   Otherwise, link with
<span class="strong"><strong>-lcoap-3</strong></span> to get the default (D)TLS library support.</p></div><div class="refsect1"><a id="_description"></a><h2>DESCRIPTION</h2><p>This describes libcoapâ€™s support for using OSCORE as defined in
<a class="ulink" href="https://rfc-editor.org/rfc/rfc8613" target="_top">RFC8613</a>.</p><p>OSCORE provides end-to-end protection between endpoints communicating using
CoAP.  (D)TLS can only protect HOP by HOP traffic which allows proxies to
manipulate information.</p></div><div class="refsect1"><a id="_callback_handler"></a><h2>CALLBACK HANDLER</h2><p><span class="strong"><strong>Callback Type: coap_oscore_save_seq_num_t</strong></span></p><p>The coap_oscore_save_seq_num_t method handler function prototype is defined as:</p><pre class="programlisting">typedef int (*coap_oscore_save_seq_num_t)(uint64_t sender_seq_num, void *param);</pre><p>and returns 0 on failure, 1 on succes.</p></div><div class="refsect1"><a id="_functions"></a><h2>FUNCTIONS</h2><p><span class="strong"><strong><a class="anchor" id="coap_oscore_is_supported"></a>Function: <a href="man_coap_oscore_is_supported.html#coap_oscore_is_supported" target="_self"><span class="man-highlight">coap_oscore_is_supported</span></a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_oscore_is_supported.html#coap_oscore_is_supported" target="_self"><span class="man-highlight">coap_oscore_is_supported</span></a></strong></span>() function returns 1 if OSCORE is supported,
otherwise 0.</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_new_oscore_conf.html#coap_new_oscore_conf" target="_self">coap_new_oscore_conf</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_new_oscore_conf.html#coap_new_oscore_conf" target="_self">coap_new_oscore_conf</a></strong></span>() function is used to build a new OSCORE
configuration. It parses the provided OSCORE configuration
in <span class="emphasis"><em>conf_mem</em></span>. The format of the keywords, encoding types and values is
documented in <span class="strong"><strong>coap-oscore-conf</strong></span>(5). It also sets an optional function
<span class="emphasis"><em>save_seq_num_func</em></span> (which gets <span class="emphasis"><em>save_seq_num_func_param</em></span> passed in) that is
called to store the next Sender Sequence Number (SSN) in non-volatile
storage. The latest next SSN from non-volatile storage (or 0) is then put in
<span class="emphasis"><em>start_seq_num</em></span>. SSN are used so that anti-replay mechanisms do not kick in
following application restarts. The rate of calling <span class="emphasis"><em>save_seq_num_func</em></span> can
be controlled by the <span class="emphasis"><em>ssn_freq</em></span> parameter as defined in <span class="strong"><strong>coap-oscore-conf</strong></span>(5).</p><p>This OSCORE configuration is then used in the client and server OSCORE version
of the setup functions.</p><p>If the server is proxy enabled and the new incoming session is OSCORE encoded
with the Outer CoAP ProxyScheme and Host options set, then the libcoap logic
will determine whether the server is the final endpoint of the session, or
whether the proxy will be forwarding the session off to another server, based
on how <span class="strong"><strong><a class="st-desc" href="man_coap_resource_proxy_uri_init.html#coap_resource_proxy_uri_init" target="_self">coap_resource_proxy_uri_init</a></strong></span>(3) configured the proxy logic.  If the
session is going to forwarded, then the OSCORE protection will not be removed.</p><p>If <span class="strong"><strong><a class="st-desc" href="man_coap_context_oscore_server.html#coap_context_oscore_server" target="_self">coap_context_oscore_server</a></strong></span>() is not called and the proxy logic (if set)
indicates the session will get forwarded, then the OSCORE protection is
untouched, otherwise the session will get dropped with an unknown critical
option error response.</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_new_oscore_recipient.html#coap_new_oscore_recipient" target="_self">coap_new_oscore_recipient</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_new_oscore_recipient.html#coap_new_oscore_recipient" target="_self">coap_new_oscore_recipient</a></strong></span>() is used to add a new <span class="emphasis"><em>recipient_id</em></span> to the
OSCORE information associated with <span class="emphasis"><em>context</em></span>.  The new <span class="emphasis"><em>recipient_id</em></span> should
be unique and this function should only be used for server based applications
as the client will only ever use the first defined <span class="emphasis"><em>recipient_id</em></span>. It is
assumed that <span class="strong"><strong><a class="st-desc" href="man_coap_context_oscore_server.html#coap_context_oscore_server" target="_self">coap_context_oscore_server</a></strong></span>() has already been called to update
<span class="emphasis"><em>context</em></span> with the appropriate OSCORE information.</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_delete_oscore_recipient.html#coap_delete_oscore_recipient" target="_self">coap_delete_oscore_recipient</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_delete_oscore_recipient.html#coap_delete_oscore_recipient" target="_self">coap_delete_oscore_recipient</a></strong></span>() is used to remove the <span class="emphasis"><em>recipient_id</em></span> from
the OSCORE information associated with <span class="emphasis"><em>context</em></span>.  OSCORE Traffic continuing
to use <span class="emphasis"><em>recipient_id</em></span> will then fail.</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_delete_oscore_conf.html#coap_delete_oscore_conf" target="_self">coap_delete_oscore_conf</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_delete_oscore_conf.html#coap_delete_oscore_conf" target="_self">coap_delete_oscore_conf</a></strong></span>() function is used to free off the
coap_oscore_conf_t structure <span class="emphasis"><em>oscore_conf</em></span> as returned by
<span class="strong"><strong><a class="st-desc" href="man_coap_new_oscore_conf.html#coap_new_oscore_conf" target="_self">coap_new_oscore_conf</a></strong></span>().  Normally this function never needs to be called
as <span class="emphasis"><em>oscore_conf</em></span> is freed off by the call the client or server setup functions.</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_new_client_session_oscore.html#coap_new_client_session_oscore" target="_self">coap_new_client_session_oscore</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_new_client_session_oscore.html#coap_new_client_session_oscore" target="_self">coap_new_client_session_oscore</a></strong></span>() is basically the same as
<span class="strong"><strong><a class="st-desc" href="man_coap_new_client_session.html#coap_new_client_session" target="_self">coap_new_client_session</a></strong></span>(3), but has an additional parameter <span class="emphasis"><em>oscore_conf</em></span>
that is created by <span class="strong"><strong><a class="st-desc" href="man_coap_new_oscore_conf.html#coap_new_oscore_conf" target="_self">coap_new_oscore_conf</a></strong></span>(). This function creates a
client endpoint for a specific <span class="emphasis"><em>context</em></span> and initiates a new client session
to the specified <span class="emphasis"><em>server</em></span> using the CoAP protocol <span class="emphasis"><em>proto</em></span> and OSCORE
protected by the <span class="emphasis"><em>oscore_conf</em></span> definition (which is freed off by this call).
If the port is set to 0 in <span class="emphasis"><em>server</em></span>, then the default CoAP port is used.
Normally <span class="emphasis"><em>local_if</em></span> would be set to NULL, but by specifying <span class="emphasis"><em>local_if</em></span> the
source of the network session can be bound to a specific IP address or port.
The session will initially have a reference count of 1.</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_new_client_session_oscore_psk.html#coap_new_client_session_oscore_psk" target="_self">coap_new_client_session_oscore_psk</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_new_client_session_oscore_psk.html#coap_new_client_session_oscore_psk" target="_self">coap_new_client_session_oscore_psk</a></strong></span>() is basically the same as
<span class="strong"><strong><a class="st-desc" href="man_coap_new_client_session_psk2.html#coap_new_client_session_psk2" target="_self">coap_new_client_session_psk2</a></strong></span>(3), but has an additional parameter
<span class="emphasis"><em>oscore_conf</em></span> that is created by <span class="strong"><strong><a class="st-desc" href="man_coap_new_oscore_conf.html#coap_new_oscore_conf" target="_self">coap_new_oscore_conf</a></strong></span>(). This
function, for a specific <span class="emphasis"><em>context</em></span>, is used to configure the TLS context
using the <span class="emphasis"><em>setup_data</em></span> variables as defined in the coap_dtls_cpsk_t structure
in the newly created endpoint session - see <span class="strong"><strong><a class="st-desc" href="man_coap_encryption.html#coap_encryption" target="_self">coap_encryption</a></strong></span>(3),
as well as OSCORE protected by the <span class="emphasis"><em>oscore_conf</em></span> definition (which is freed
off by this call). The connection is to the specified <span class="emphasis"><em>server</em></span> using the CoAP
protocol <span class="emphasis"><em>proto</em></span>.  If the port is set to 0 in <span class="emphasis"><em>server</em></span>, then the default CoAP
port is used.  Normally <span class="emphasis"><em>local_if</em></span> would be set to NULL, but by specifying
<span class="emphasis"><em>local_if</em></span> the source of the network session can be bound to a specific IP
address or port. The session will initially have a reference count of 1.</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_new_client_session_oscore_pki.html#coap_new_client_session_oscore_pki" target="_self">coap_new_client_session_oscore_pki</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_new_client_session_oscore_pki.html#coap_new_client_session_oscore_pki" target="_self">coap_new_client_session_oscore_pki</a></strong></span>() is basically the same as
<span class="strong"><strong><a class="st-desc" href="man_coap_new_client_session_pki.html#coap_new_client_session_pki" target="_self">coap_new_client_session_pki</a></strong></span>(3), but has an additional parameter
<span class="emphasis"><em>oscore_conf</em></span> that is created by <span class="strong"><strong><a class="st-desc" href="man_coap_new_oscore_conf.html#coap_new_oscore_conf" target="_self">coap_new_oscore_conf</a></strong></span>(). This
function, for a specific <span class="emphasis"><em>context</em></span>, is used to configure the TLS context using
the <span class="emphasis"><em>setup_data</em></span> variables as defined in the coap_dtls_pki_t structure in the
newly created endpoint session - see <span class="strong"><strong><a class="st-desc" href="man_coap_encryption.html#coap_encryption" target="_self">coap_encryption</a></strong></span>(3), as well as OSCORE
protected by the <span class="emphasis"><em>oscore_conf</em></span> definition (which is freed off by this call).
The connection is to the specified <span class="emphasis"><em>server</em></span> using the CoAP protocol <span class="emphasis"><em>proto</em></span>.
If the port is set to 0 in <span class="emphasis"><em>server</em></span>, then the default CoAP port is used.
Normally <span class="emphasis"><em>local_if</em></span> would be set to NULL, but by specifying <span class="emphasis"><em>local_if</em></span> the
source of the network session can be bound to a specific IP address or port.
The session will initially have a reference count of 1.</p><p><span class="strong"><strong>Function: <a class="st-desc" href="man_coap_context_oscore_server.html#coap_context_oscore_server" target="_self">coap_context_oscore_server</a>()</strong></span></p><p>The <span class="strong"><strong><a class="st-desc" href="man_coap_context_oscore_server.html#coap_context_oscore_server" target="_self">coap_context_oscore_server</a></strong></span>() function is used to enable the server to
support OSCORE incoming sessions. It updates <span class="emphasis"><em>context</em></span> with the OSCORE
configure <span class="emphasis"><em>oscore_conf</em></span> (which is freed off by this call).</p></div><div class="refsect1"><a id="_return_values"></a><h2>RETURN VALUES</h2><p><span class="strong"><strong><a class="st-desc" href="man_coap_new_client_session_oscore.html#coap_new_client_session_oscore" target="_self">coap_new_client_session_oscore</a></strong></span>(), <span class="strong"><strong><a class="st-desc" href="man_coap_new_client_session_oscore_psk.html#coap_new_client_session_oscore_psk" target="_self">coap_new_client_session_oscore_psk</a></strong></span>()
and <span class="strong"><strong><a class="st-desc" href="man_coap_new_client_session_oscore_pki.html#coap_new_client_session_oscore_pki" target="_self">coap_new_client_session_oscore_pki</a></strong></span>() return a newly created
client session or NULL if there is a malloc or parameter failure.</p><p><span class="strong"><strong><a class="st-desc" href="man_coap_new_oscore_conf.html#coap_new_oscore_conf" target="_self">coap_new_oscore_conf</a></strong></span>() returns a <span class="emphasis"><em>coap_oscore_conf_t</em></span>
or NULL on failure.</p><p><span class="strong"><strong><a class="st-desc" href="man_coap_oscore_is_supported.html#coap_oscore_is_supported" target="_self"><span class="man-highlight">coap_oscore_is_supported</span></a></strong></span>(), <span class="strong"><strong><a class="st-desc" href="man_coap_context_oscore_server.html#coap_context_oscore_server" target="_self">coap_context_oscore_server</a></strong></span>(),
<span class="strong"><strong><a class="st-desc" href="man_coap_delete_oscore_conf.html#coap_delete_oscore_conf" target="_self">coap_delete_oscore_conf</a></strong></span>(), <span class="strong"><strong><a class="st-desc" href="man_coap_new_oscore_recipient.html#coap_new_oscore_recipient" target="_self">coap_new_oscore_recipient</a></strong></span>() and
<span class="strong"><strong><a class="st-desc" href="man_coap_delete_oscore_recipient.html#coap_delete_oscore_recipient" target="_self">coap_delete_oscore_recipient</a></strong></span>() return 0 on failure, 1 on success.</p></div><div class="refsect1"><a id="_examples"></a><h2>EXAMPLES</h2><p><span class="strong"><strong>Client Setup</strong></span></p><pre class="programlisting">#include &lt;coap3/coap.h&gt;

#include &lt;netinet/in.h&gt;
#include &lt;stdio.h&gt;

static uint8_t oscore_config[] =
  "master_secret,hex,\"0102030405060708090a0b0c0d0e0f10\"\n"
  "master_salt,hex,\"9e7ca92223786340\"\n"
  "server_id,ascii,\"client\"\n"
  "recipient_id,ascii,\"server\"\n"
  "replay_window,integer,30\n"
  "aead_alg,integer,10\n"
  "hkdf_alg,integer,-10\n"
;
static FILE *oscore_seq_num_fp = NULL;
/* Not a particularly safe place to keep next Sender Sequence Number ... */
static const char* oscore_seq_save_file = "/tmp/client.seq";

static int
oscore_save_seq_num(uint64_t sender_seq_num, void *param COAP_UNUSED) {
  if (oscore_seq_num_fp) {
    rewind(oscore_seq_num_fp);
    fprintf(oscore_seq_num_fp, "%lu\n", sender_seq_num);
    fflush(oscore_seq_num_fp);
  }
  return 1;
}

static coap_session_t *
setup_client_session (struct in_addr ip_address) {
  coap_session_t *session;
  coap_address_t server;
  /* See <a href="man_coap_context.html#coap_context" target="_self">coap_context</a>(3) */
  coap_context_t *context = <a href="man_coap_new_context.html#coap_new_context" target="_self">coap_new_context</a>(NULL);

  if (!context)
    return NULL;

  /* See <a href="man_coap_block.html#coap_block" target="_self">coap_block</a>(3) */
  <a href="man_coap_context_set_block_mode.html#coap_context_set_block_mode" target="_self">coap_context_set_block_mode</a>(context,
                              COAP_BLOCK_USE_LIBCOAP | COAP_BLOCK_SINGLE_BODY);


  <a href="man_coap_address_init.html#coap_address_init" target="_self">coap_address_init</a>(&amp;server);
  server.addr.sa.sa_family = AF_INET;
  server.addr.sin.sin_addr = ip_address;
  server.addr.sin.sin_port = htons (5683);

  if (<a href="man_coap_oscore_is_supported.html#coap_oscore_is_supported" target="_self"><span class="man-highlight">coap_oscore_is_supported</span></a>()) {
    coap_str_const_t config = { sizeof (oscore_config), oscore_config };
    uint64_t start_seq_num = 0;
    coap_oscore_conf_t *oscore_conf;

    if (oscore_seq_save_file) {
      oscore_seq_num_fp = fopen(oscore_seq_save_file, "r+");
      if (oscore_seq_num_fp == NULL) {
        /* Try creating it */
        oscore_seq_num_fp = fopen(oscore_seq_save_file, "w+");
        if (oscore_seq_num_fp == NULL) {
          <a href="man_coap_log_err.html#coap_log_err" target="_self">coap_log_err</a>("OSCORE save restart info file error: %s\n",
                   oscore_seq_save_file);
          return NULL;
        }
      }
      fscanf(oscore_seq_num_fp, "%ju", &amp;start_seq_num);
    }
    oscore_conf = <a href="man_coap_new_oscore_conf.html#coap_new_oscore_conf" target="_self">coap_new_oscore_conf</a>(config, oscore_save_seq_num,
                                       NULL, start_seq_num);
    if (!oscore_conf) {
      <a href="man_coap_free_context.html#coap_free_context" target="_self">coap_free_context</a>(context);
      return NULL;
    }
    session = <a href="man_coap_new_client_session_oscore.html#coap_new_client_session_oscore" target="_self">coap_new_client_session_oscore</a>(context, NULL, &amp;server,
                                             COAP_PROTO_UDP, oscore_conf);
  } else {
    session = <a href="man_coap_new_client_session.html#coap_new_client_session" target="_self">coap_new_client_session</a>(context, NULL, &amp;server, COAP_PROTO_UDP);
  }
  if (!session) {
    <a href="man_coap_free_context.html#coap_free_context" target="_self">coap_free_context</a>(context);
    return NULL;
  }
  /* The context is in session-&gt;context */
  return session;
}</pre><p><span class="strong"><strong>Server Setup</strong></span></p><pre class="programlisting">#include &lt;coap3/coap.h&gt;
#include &lt;stdio.h&gt;

static uint8_t oscore_config[] =
  "master_secret,hex,\"0102030405060708090a0b0c0d0e0f10\"\n"
  "master_salt,hex,\"9e7ca92223786340\"\n"
  "sender_id,ascii,\"server\"\n"
  "recipient_id,ascii,\"client\"\n"
  "replay_window,integer,30\n"
  "aead_alg,integer,10\n"
  "hkdf_alg,integer,-10\n"
;
static FILE *oscore_seq_num_fp = NULL;
/* Not a particularly safe place to keep next Sender Sequence Number ... */
static const char* oscore_seq_save_file = "/tmp/server.seq";

static int
oscore_save_seq_num(uint64_t sender_seq_num, void *param COAP_UNUSED) {
  if (oscore_seq_num_fp) {
    rewind(oscore_seq_num_fp);
    fprintf(oscore_seq_num_fp, "%lu\n", sender_seq_num);
    fflush(oscore_seq_num_fp);
  }
  return 1;
}

static int
setup_context (void) {
  /* See <a href="man_coap_context.html#coap_context" target="_self">coap_context</a>(3) */
  coap_context_t *context = <a href="man_coap_new_context.html#coap_new_context" target="_self">coap_new_context</a>(NULL);

  if (!context)
    return 0;

  /* See <a href="man_coap_block.html#coap_block" target="_self">coap_block</a>(3) */
  <a href="man_coap_context_set_block_mode.html#coap_context_set_block_mode" target="_self">coap_context_set_block_mode</a>(context,
                              COAP_BLOCK_USE_LIBCOAP | COAP_BLOCK_SINGLE_BODY);

  if (<a href="man_coap_oscore_is_supported.html#coap_oscore_is_supported" target="_self"><span class="man-highlight">coap_oscore_is_supported</span></a>()) {
    coap_str_const_t config = { sizeof (oscore_config), oscore_config };
    uint64_t start_seq_num = 0;
    coap_oscore_conf_t *oscore_conf;

    if (oscore_seq_save_file) {
      oscore_seq_num_fp = fopen(oscore_seq_save_file, "r+");
      if (oscore_seq_num_fp == NULL) {
        /* Try creating it */
        oscore_seq_num_fp = fopen(oscore_seq_save_file, "w+");
        if (oscore_seq_num_fp == NULL) {
          <a href="man_coap_log_err.html#coap_log_err" target="_self">coap_log_err</a>("OSCORE save restart info file error: %s\n",
                   oscore_seq_save_file);
          return 0;
        }
      }
      fscanf(oscore_seq_num_fp, "%ju", &amp;start_seq_num);
    }
    oscore_conf = <a href="man_coap_new_oscore_conf.html#coap_new_oscore_conf" target="_self">coap_new_oscore_conf</a>(config, oscore_save_seq_num,
                                       NULL, start_seq_num);
    if (!oscore_conf) {
      <a href="man_coap_free_context.html#coap_free_context" target="_self">coap_free_context</a>(context);
      return 0;
    }
    <a href="man_coap_context_oscore_server.html#coap_context_oscore_server" target="_self">coap_context_oscore_server</a>(context, oscore_conf);
  }
  return 1;
}</pre></div><div class="refsect1"><a id="_see_also"></a><h2>SEE ALSO</h2><p><span class="strong"><strong><a class="st-desc" href="man_coap_endpoint_client.html#coap_endpoint_client" target="_self">coap_endpoint_client</a></strong></span>(3), <span class="strong"><strong><a class="st-desc" href="man_coap_endpoint_server.html#coap_endpoint_server" target="_self">coap_endpoint_server</a></strong></span>(3) and <span class="strong"><strong>coap-oscore-conf</strong></span>(5)</p></div><div class="refsect1"><a id="_further_information"></a><h2>FURTHER INFORMATION</h2><p>See</p><p>"<a class="ulink" href="https://rfc-editor.org/rfc/rfc7252" target="_top">RFC7252: The Constrained Application Protocol (CoAP)</a>"</p><p>"<a class="ulink" href="https://rfc-editor.org/rfc/rfc8613" target="_top">RFC8613: Object Security for Constrained RESTful Environments (OSCORE)</a>"</p><p>for further information.</p></div><div class="refsect1"><a id="_bugs"></a><h2>BUGS</h2><p>Please report bugs on the mailing list for libcoap:
<a class="ulink" href="mailto:libcoap-developers@lists.sourceforge.net" target="_top">libcoap-developers@lists.sourceforge.net</a> or raise an issue on GitHub at
<a class="ulink" href="https://github.com/obgm/libcoap/issues" target="_top">https://github.com/obgm/libcoap/issues</a></p></div><div class="refsect1"><a id="_authors"></a><h2>AUTHORS</h2><p>The libcoap project &lt;<a class="ulink" href="mailto:libcoap-developers@lists.sourceforge.net" target="_top">libcoap-developers@lists.sourceforge.net</a>&gt;</p></div></div></body></html> coap_oscore_is_supported(3)</p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Sep 14 2023 12:43:42 for libcoap by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
